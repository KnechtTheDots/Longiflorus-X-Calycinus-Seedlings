mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size) %>%
mutate(seed_size = stn(seed_size),
start = stn(start),
finish = stn(finish),
survive = death_day - 3)
d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
z <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
is.na(z$start)
d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day)
d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
view()
d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
view()
d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size) %>%
view()
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
full
view(full)
stn(full$start[!(is.na(full$start))])
ifelse(is.na(full$start), -1, (full$start-mean(full$start[!(is.na(full$start))]))/sd(full$start[!(is.na(full$start))]))
ifelse(is.na(full$start), -100, (full$start-mean(full$start[!(is.na(full$start))]))/sd(full$start[!(is.na(full$start))]))
sum(is.na(full$start))
which(is.na(full$start))
which(!(is.na(full$start)))
full$ind[which(!(is.na(full$start)))]
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
full
full
mu <- mean(full$start[!(is.na(full$start))])
mu
sd <- sd(full$start[!(is.na(full$start))])
sd
ifelse(is.na(full$start), -100, (full$start - mu)/sd)
full$start <- ifelse(is.na(full$start), -100, (full$start - mu)/sd)
full
full$finish <- stn(full$finish)
full
view(full)
full$seed_size <- stn(full$seed_size)
d <- read.csv("data/seed_growth_vs_seed_size.csv")
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
mu <- mean(full$start[!(is.na(full$start))])
sd <- sd(full$start[!(is.na(full$start))])
full$start <- ifelse(is.na(full$start), -100, (full$start - mu)/sd)
full$finish <- stn(full$finish)
full$seed_size <- stn(full$seed_size)
full$survive <- full$death_day - 3
view(full)
full$start==-100
full$ind[full$start == 100]
full$ind[full$start == -100]
matrix(c(rep(1, nrow(full)),
full$seed_size,
full$germ_day))
matrix(c(rep(1, nrow(full)),
full$seed_size,
full$germ_day), ncol = 3)
X <- matrix(c(rep(1, nrow(full)),
full$seed_size,
full$germ_day), ncol = 3)
library(tidyverse)
source("scripts/functions.R")
df <- read.csv("data/main.csv")
set.seed(12042014)
d <- read.csv("data/seed_growth_vs_seed_size.csv")
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
rgr_dat <- d %>%
drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
mutate(l_size = log(size)) %>%
separate(day, into = (c("a", "day"))) %>%
mutate(day = as.numeric(day),
age = day - germ_day) %>%
filter(age > 0) %>%
select(ind, age, l_size)
d <- read.csv("data/seed_growth_vs_seed_size.csv")
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
mu <- mean(full$start[!(is.na(full$start))])
sd <- sd(full$start[!(is.na(full$start))])
full$start <- ifelse(is.na(full$start), -100, (full$start - mu)/sd)
full$finish <- stn(full$finish)
full$seed_size <- stn(full$seed_size)
full$survive <- full$death_day - 3
X <- matrix(c(rep(1, nrow(full)),
full$seed_size,
full$germ_day), ncol = 3)
stan_dat <- list(
N = nrow(full),
N_obs = sum(full$start != -100),
N_miss = sum(full$start == -100),
ind = full$ind,
ii_obs = full$ind[full$start != -100],
ii_miss = full$ind[full$start == -100],
start_obs = full$start[full$start!=-100],
size_end = full$finish,
seed_size = full$seed_size,
germ_day = full$germ_day,
N_rgr = nrow(rgr_dat),
l_size = rgr_dat$l_size,
age = rgr_dat$age,
ind_rgr = rgr_dat$ind
)
library(cmdstanr)
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
fit$print(max_rows = 336)
rstan:::rstudio_stanc("scripts/size.stan")
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
fit$print(max_rows = 336)
rstan:::rstudio_stanc("scripts/size.stan")
rstan:::rstudio_stanc("scripts/size.stan")
library(cmdstanr)
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
rstan:::rstudio_stanc("scripts/size.stan")
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
fit$print(max_rows = 336)
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
fit$print(max_rows = 336)
y <- stan_dat$size_end
library(shinystan)
launch_shinystan(fit)
full$survive
stan_dat <- list(
N = nrow(full),
N_obs = sum(full$start != -100),
N_miss = sum(full$start == -100),
ind = full$ind,
ii_obs = full$ind[full$start != -100],
ii_miss = full$ind[full$start == -100],
start_obs = full$start[full$start!=-100],
size_end = full$finish,
seed_size = full$seed_size,
germ_day = full$germ_day,
N_rgr = nrow(rgr_dat),
l_size = rgr_dat$l_size,
age = rgr_dat$age,
ind_rgr = rgr_dat$ind,
survive = full$survive
)
library(cmdstanr)
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
fit$print(max_rows = 336)
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
fit$print(max_rows = 336)
y <- stan_dat$size_end
library(shinystan)
launch_shinystan(fit)
d <- read.csv("data/seed_growth_vs_seed_size.csv")
rgr_dat <- d %>%
drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
mutate(l_size = log(size)) %>%
separate(day, into = (c("a", "day"))) %>%
mutate(day = as.numeric(day),
age = day - germ_day) %>%
filter(age > 0) %>%
select(ind, age, l_size)
library(tidyverse)
source("scripts/functions.R")
df <- read.csv("data/main.csv")
set.seed(12042014)
d <- read.csv("data/seed_growth_vs_seed_size.csv")
rgr_dat <- d %>%
drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
mutate(l_size = log(size)) %>%
separate(day, into = (c("a", "day"))) %>%
mutate(day = as.numeric(day),
age = day - germ_day) %>%
filter(age > 0) %>%
select(ind, age, l_size)
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
mu <- mean(full$start[!(is.na(full$start))])
sd <- sd(full$start[!(is.na(full$start))])
full$start <- ifelse(is.na(full$start), -100, (full$start - mu)/sd)
full$finish <- stn(full$finish)
full$seed_size <- stn(full$seed_size)
full$survive <- full$death_day - 3
stan_dat <- list(
N = nrow(full),
N_obs = sum(full$start != -100),
N_miss = sum(full$start == -100),
ind = full$ind,
ii_obs = full$ind[full$start != -100],
ii_miss = full$ind[full$start == -100],
start_obs = full$start[full$start!=-100],
size_end = full$finish,
seed_size = full$seed_size,
germ_day = full$germ_day,
N_rgr = nrow(rgr_dat),
l_size = rgr_dat$l_size,
age = rgr_dat$age,
ind_rgr = rgr_dat$ind,
survive = full$survive
)
library(cmdstanr)
mod <- cmdstan_model("scripts/size.stan", compile = F)
mod$check_syntax()
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
d <- read.csv("data/seed_growth_vs_seed_size.csv")
rgr_dat <- d %>%
drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
mutate(l_size = log(size)) %>%
separate(day, into = (c("a", "day"))) %>%
mutate(day = as.numeric(day),
age = day - germ_day) %>%
filter(age > 0) %>%
select(ind, age, l_size)
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
mu <- mean(full$start[!(is.na(full$start))])
sd <- sd(full$start[!(is.na(full$start))])
full$start <- ifelse(is.na(full$start), -100, (full$start - mu)/sd)
full$finish <- stn(full$finish)
full$seed_size <- stn(full$seed_size)
full$survive <- full$death_day - 3
stan_dat <- list(
N = nrow(full),
N_obs = sum(full$start != -100),
N_miss = sum(full$start == -100),
ind = full$ind,
ii_obs = full$ind[full$start != -100],
ii_miss = full$ind[full$start == -100],
start_obs = full$start[full$start!=-100],
size_end = full$finish,
seed_size = full$seed_size,
germ_day = full$germ_day,
N_rgr = nrow(rgr_dat),
l_size = rgr_dat$l_size,
age = rgr_dat$age,
ind_rgr = rgr_dat$ind,
survive = full$survive
)
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4
)
?cmdstanr::sample
d <- read.csv("data/seed_growth_vs_seed_size.csv")
rgr_dat <- d %>%
drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
mutate(l_size = log(size)) %>%
separate(day, into = (c("a", "day"))) %>%
mutate(day = as.numeric(day),
age = day - germ_day) %>%
filter(age > 0) %>%
select(ind, age, l_size)
full <- d %>% drop_na(germ_day, death_day) %>%
mutate(ind = 1:105) %>%
pivot_longer(4:10, names_to = "day", values_to = "size") %>%
drop_na(size) %>%
drop_na(size) %>%
separate(day, c("fubar", "day")) %>%
mutate(day = as.numeric(day)) %>%
select(ind, seed_size, germ_day, death_day, day, size) %>%
mutate(age = day - germ_day) %>%
filter(age == 1 | day == 17) %>%
mutate(tp = ifelse(age == 1, "start","finish")) %>%
pivot_wider(id_cols = c(ind, seed_size, germ_day, death_day),
names_from = tp, values_from = size)
mu <- mean(full$start[!(is.na(full$start))])
sd <- sd(full$start[!(is.na(full$start))])
full$start <- ifelse(is.na(full$start), -100, (full$start - mu)/sd)
full$finish <- stn(full$finish)
full$seed_size <- stn(full$seed_size)
full$survive <- full$death_day - 3
stan_dat <- list(
N = nrow(full),
N_obs = sum(full$start != -100),
N_miss = sum(full$start == -100),
ind = full$ind,
ii_obs = full$ind[full$start != -100],
ii_miss = full$ind[full$start == -100],
start_obs = full$start[full$start!=-100],
size_end = full$finish,
seed_size = full$seed_size,
germ_day = full$germ_day,
N_rgr = nrow(rgr_dat),
l_size = rgr_dat$l_size,
age = rgr_dat$age,
ind_rgr = rgr_dat$ind,
survive = full$survive
)
mod <- cmdstan_model("scripts/size.stan")
fit <- mod$sample(
data = stan_dat,
chains = 4,
parallel_chains = 4,
show_messages = F
)
fit$print()
